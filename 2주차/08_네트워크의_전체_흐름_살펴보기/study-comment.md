## 32장 랜 카드에서의 데이터 전달과 처리

### 1. 네트워크의 구성

- OSI 모델 정리
    - 물리 계층: 데이터를 전기 신호로 변환한다.
    - 데이터 링크 계층: 랜에서 데이터를 송수신한다.
    - 네트워크 계층: 다른 네트워크에 있는 목적지에 데이터를 전달한다.
    - 전송 계층: 목적지에 데이터를 정확하게 전달한다.
    - 응용 계층(세션 계층, 표현 계층 포함): 애플리케이션 등에서 사용하는 데이터를 송수신한다.

### 2. 컴퓨터의 데이터가 전기 신호로 변환되는과정

- 컴퓨터의 웹 브라우저에 URL을 입력할 때부터 웹 서버에 도착할 때까지 캡슐화와 역캡슐화가 이뤄진다.
- 데이터가 전달되고 처리되는 과정을 살펴보자.
    - 웹 사이트에 접속하기 위해 응용 계층에서 시작을 한다.
    - 웹 브라우저에 URL을 입력하고 엔터키를 누르면 캡슐화가 시작된다.
    - 응용 계층에서는 웹 서버에 있는 html을 얻어야 하므로 HTTP 메시지를 보낸다.
        - 예) GET /index.html HTTP/1.1
    - 데이터가 전송 계층에 전달되고, TCP 헤더가 붙는다.
        - TCP 헤더에는 어느 애플리케이션에 데이터를 보내야 하는지에 대한 정보가 들어있다.
            - 출발지 포트 번호, 목적지 포트 번호
    - 데이터가 네트워크 계층에 전달되고, IP 헤더가 붙는다.
        - IP 헤더에 출발지 컴퓨터와 목적지 서버의 위치가 추가된다.
            - 출발지 IP주소, 목적지 IP주소
            - IP 헤더가 붙은 데이터를 IP 패킷이라고 한다.
    - 데이터 링크 계층으로 전달되고, 이더넷 헤더가 추가된다.
        - 이더넷 헤더가 있는 데이터를 이더넷 프레임이라고 한다.
    - 이더넷 프레임이 된 후 물리 계층에서 전기 신호로 변환되어 네트워크로 전송된다.
        - 물리 계층에서 전기 신호로 변환할 때 데이터가 필요하다.

          ![img1.daumcdn.png](https://prod-files-secure.s3.us-west-2.amazonaws.com/ccee4141-ca57-49be-9629-57442a73b9ab/f74549a6-6f60-4bc9-902d-9e540f0ce8aa/img1.daumcdn.png)


## 33장 스위치와 라우터에서의 데이터 전달과 처리

- 스위치 A
    - 컴퓨터에서 보낸 전기 신호가 물리 계층에서 데이터로 변환되어 데이터 링크 계층으로 전달된다.
    - 데이터 링크 계층에서 물리 계층으로 넘겨진 데이터는 전기 신호로 변환된 후 라우터 A로 전송된다.
- 라우터 A
    - 물리 계층에서 수신된 전기 신호를 데이터로 변환한 후 데이터 링크 계층으로 전달된다.
    - 데이터 링크 계층에서 이더넷의 목적지 MAC 주소와 자신의 MAC 주소를 비교한 후 주소가 같다면 역캡슐화를 진행한다.
    - 이후 네트워크 계층으로 데이터를 전달하여 라우팅 테이블과 목적지 IP 주소를 비교하고 라우팅을 수행하여 출발지 IP 주소를 라우터 A의 외부 IP 주소로 변경한다.
    - 변경된 데이터를 데이터 링크 계층으로 넘긴 후 라우터 B로 보내지도록 이더넷 헤더와 트레일러를 붙인다.
    - 마지막으로 물리 계층으로 보내진 데이터는 전기 신호로 변환된 후 네트워크로 전달된다.
- 라우터 B
    - 라우터 B에 도착한 전기 신호는 물리 계층에서 데이터로 변환되어 데이터 링크 계층으로 전달된다.
    - 데이터 링크 계층에서는 목적지 MAC 주소와 자신의 MAC 주소 비교 후 역캡슐화 수행한다.
    - 이후 네트워크 계층으로 데이터를 전달하여 라우팅 테이블과 목적지 IP 주소를 비교, 라우팅을 수행하여 출발지 IP 주소를 라우터 B의 내부 IP 주소로 변경한다.
    - 변경된 데이터를 데이터 링크 계층으로 넘긴 후 스위치 B에 전달되도록 이더넷 헤더와 트레일러를 붙인다.
    - 마지막으로 물리 계층으로 보내진 데이터는 전기 신호로 변환된 후 네트워크로 전달된다.
- 스위치 B
    - 라우터 B에서 보낸 전기 신호가 물리 계층에서 데이터로 변환되어 데이터 링크 계층으로 전달된다.
    - 데이터 링크 계층에서 물리 계층으로 넘겨진 데이터는 전기 신호로 변환된 후 웹 서버로 전송된다.

## 34장 웹 서버에서의 데이터 전달과 처리

- 웹 서버에서의 역캡슐화도 동일하게 일어난다.
- 스위치B에서 전기신호로 변환된 데이터를 전달받는다.
- 데이터 링크 계층에서 이더넷 프레임의 목적지 MAC주소와 자신의 MAC주소가 같으면 이더넷 헤더와 트레일러를 분리한다.
- 네트워크 계층에서 목적지 IP주소와 웹서버의 IP주소가 같으면 IP헤더를 분리한다.
- 전송 계층에서 목적지 포트번호를 확인하여 어떤 애플리케이션으로 전달하는지 판단하고 TCP헤더를 분리한다.
- 응용 계층에서 HTTP response를 하여 알맞은 페이지, 이미지 등을 반환한다.